name: MedTempo Ruby Backend

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
      -
        name: Checkout
        uses: actions/checkout@v3
      - 
        name: Build Docker Container
        run: docker build -t medtempo-backend --file Dockerfile --target test .
        
      - 
        name: Make Testes 
        run: sudo docker run -it --name backend-instance --rm --network host medtempo-backend
        env: 
          DB_ID: ${{ secrets.DB_ID }}
          DB_REGION: ${{ secrets.DB_REGION }} 
          DB_KEYSPACE: ${{ secrets.DB_KEYSPACE }} 
          DB_APPLICATION_TOKEN: ${{ secrets.DB_APPLICATION_TOKEN }} 
          ENV_SECRET: ${{ secrets.ENV_SECRET }} 
          A2_SECRET: ${{ secrets.A2_SECRET }} 
          
      
